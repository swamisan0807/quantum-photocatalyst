<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Quantum Photocatalyst Simulator</title>
  <style>
    :root {
      --bg1: #060612; --panel: #071225; --accent1: #00d8ff; --accent2: #ff00d4;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Inter, system-ui, sans-serif;
      background: linear-gradient(180deg, #060612 0%, #081229 100%);
      color: #cfefff;
      min-height: 100vh;
    }
    .grid-bg {
      position: fixed; inset: 0;
      background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 60px 60px; opacity: 0.9; z-index: -1;
    }
    header { padding: 28px 24px; text-align: center; }
    h1 {
      font-size: 32px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      letter-spacing: 1px; font-weight: 800;
    }
    .subtitle { color: #9fb7d8; margin-top: 6px; font-size: 15px; }
    .stats-bar {
      display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;
    }
    .stat-item {
      text-align: center; padding: 10px 18px;
      background: rgba(0,216,255,0.08); border-radius: 8px;
      border: 1px solid rgba(0,216,255,0.2);
    }
    .stat-value { font-size: 22px; font-weight: 700; color: var(--accent1); }
    .stat-label { font-size: 11px; color: #9fb7d8; margin-top: 4px; }
    .container {
      max-width: 1600px; margin: 24px auto; padding: 0 18px;
      display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
    }
    .panel {
      background: var(--panel); border-radius: 14px; padding: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6); border: 1px solid rgba(0,216,255,0.06);
    }
    .panel h3 { margin: 0 0 12px 0; color: #00d8ff; font-size: 18px; }
    label {
      display: block; margin: 10px 0 6px; color: #bfeaff; font-weight: 500; font-size: 13px;
    }
    select, input[type="range"], input[type="number"] {
      width: 100%; padding: 10px; border-radius: 8px;
      border: 1px solid rgba(0,216,255,0.2);
      background: rgba(255,255,255,0.04); color: #e6f9ff; font-size: 14px;
    }
    select[multiple] {
      height: 120px; padding: 8px; background: rgba(7,18,37,0.8);
    }
    select[multiple] option {
      padding: 6px 10px; margin: 2px 0; border-radius: 4px; cursor: pointer;
    }
    select[multiple] option:checked {
      background: linear-gradient(90deg, rgba(0,216,255,0.3), rgba(255,0,212,0.3));
      font-weight: 600;
    }
    .btn {
      margin-top: 14px; padding: 12px 18px; border-radius: 10px; border: none;
      width: 100%; cursor: pointer; font-weight: 700; font-size: 15px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #060612; box-shadow: 0 6px 30px rgba(0,216,255,0.12);
      transition: transform 0.2s;
    }
    .btn:hover { transform: translateY(-2px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .select-all-btn {
      font-size: 11px; padding: 5px 12px;
      background: rgba(0,216,255,0.1); border: 1px solid rgba(0,216,255,0.3);
      border-radius: 5px; color: #00d8ff; cursor: pointer;
      margin-top: 6px; margin-right: 8px;
    }
    .param-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;
    }
    .circuit {
      min-height: 250px; background: rgba(0,0,0,0.25); border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      color: #84dfff; padding: 15px; border: 1px solid rgba(0,216,255,0.1);
    }
    .circuit img { max-width: 100%; border-radius: 8px; }
    .results-box {
      margin-top: 12px; background: rgba(255,255,255,0.02);
      padding: 16px; border-radius: 8px; border: 1px solid rgba(0,216,255,0.1);
    }
    .metric-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 6px;
      font-size: 13px; margin-top: 8px;
    }
    .results-box strong { color: #00d8ff; }
    .download-section {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px;
    }
    .download-btn {
      padding: 10px; background: linear-gradient(135deg, #2a3f5f, #1a2f4f);
      border: 1px solid rgba(0,216,255,0.3); border-radius: 8px;
      color: #00d8ff; cursor: pointer; font-size: 12px; font-weight: 600; text-align: center;
    }
    .download-btn.excel {
      background: linear-gradient(135deg, #1e7145, #0d5c2f); color: #00ff80;
    }
    footer { text-align: center; color: #7f9fbf; padding: 18px; font-size: 13px; }
    @media(max-width: 1200px) {
      .container { grid-template-columns: 1fr; }
      .param-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  
  <header>
    <h1>‚öõÔ∏è Advanced Quantum Photocatalyst Simulator</h1>
    <div class="subtitle">Complete photocatalysis analysis: Dye degradation ‚Ä¢ Absorption spectroscopy ‚Ä¢ Optical bandgap ‚Ä¢ Tauc plot</div>
    <div class="stats-bar">
      <div class="stat-item"><div class="stat-value">200+</div><div class="stat-label">Materials</div></div>
      <div class="stat-item"><div class="stat-value" id="catCount">1</div><div class="stat-label">Catalysts</div></div>
      <div class="stat-item"><div class="stat-value" id="dyeCount">1</div><div class="stat-label">Dyes</div></div>
      <div class="stat-item"><div class="stat-value" id="qubitCount">15</div><div class="stat-label">Qubits</div></div>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <h3>üß™ Material Configuration</h3>

      <label>üé® Target Dyes (Multiple concentrations supported)</label>
      <select id="dyeType" multiple>
        <option value="MethyleneBlue" selected>Methylene Blue</option>
        <option value="RhodamineB">Rhodamine B</option>
        <option value="MethylOrange">Methyl Orange</option>
        <option value="CrystalViolet">Crystal Violet</option>
        <option value="CongoRed">Congo Red</option>
        <option value="MalachiteGreen">Malachite Green</option>
      </select>
      <button class="select-all-btn" onclick="selectAll('dyeType')">All</button>
      <button class="select-all-btn" onclick="clearAll('dyeType')">Clear</button>

      <label>‚öóÔ∏è Photocatalyst Systems</label>
      <select id="materialType" multiple>
        <optgroup label="Metal Oxides & Sulfides">
          <option value="TiO2" selected>Titanium Dioxide (TiO‚ÇÇ)</option>
          <option value="ZnO">Zinc Oxide (ZnO)</option>
          <option value="WO3">Tungsten Trioxide (WO‚ÇÉ)</option>
          <option value="BiVO4">Bismuth Vanadate (BiVO‚ÇÑ)</option>
          <option value="CdS">Cadmium Sulfide (CdS)</option>
          <option value="Ag3PO4">Silver Phosphate (Ag‚ÇÉPO‚ÇÑ)</option>
        </optgroup>
        <optgroup label="Advanced Carbon Systems">
          <option value="gC3N4">g-C‚ÇÉN‚ÇÑ</option>
          <option value="CNT">Carbon Nanotubes</option>
          <option value="Graphene">Graphene</option>
          <option value="RGO">Reduced Graphene Oxide</option>
        </optgroup>
        <optgroup label="CNT-Doped Systems">
          <option value="CNT-AgNPs">CNT-doped Ag Nanoparticles</option>
          <option value="CNT-Ag-Zn-BMNPs">CNT-Ag-Zn Bimetallic NPs</option>
          <option value="CNT-Ni-Co-Fe">CNT-Ni-Co-Fe System</option>
        </optgroup>
        <optgroup label="Bimetallic Nanoparticles (BMNPs)">
          <option value="Ag-Au-BMNPs">Ag-Au BMNPs</option>
          <option value="Pt-Pd-BMNPs">Pt-Pd BMNPs</option>
          <option value="Cu-Ni-BMNPs">Cu-Ni BMNPs</option>
        </optgroup>
        <optgroup label="Transition Metal Nanocomposites (TMNCs)">
          <option value="RGO-TMNCs">RGO-based TMNCs</option>
          <option value="CNT-TMNCs">CNT-based TMNCs</option>
          <option value="Polymer-TMNCs">Flexible Polymer TMNCs</option>
        </optgroup>
      </select>
      <button class="select-all-btn" onclick="selectAll('materialType')">All</button>
      <button class="select-all-btn" onclick="clearAll('materialType')">Clear</button>

      <div class="param-grid">
        <div>
          <label>Dye Conc. <span id="dyeConcVal">20 ppm</span></label>
          <input id="dyeConc" type="range" min="1" max="100" value="20">
        </div>
        <div>
          <label>Add Concentration Variant</label>
          <input id="dyeConcVariant" type="number" placeholder="e.g., 50" style="padding:8px">
        </div>
        <div>
          <label>Catalyst Conc. <span id="catConcVal">5 mg</span></label>
          <input id="catConc" type="range" min="1" max="10" step="0.5" value="5">
        </div>
        <div>
          <label>Particle Size <span id="catSizeVal">50 nm</span></label>
          <input id="catSize" type="range" min="10" max="100" step="5" value="50">
        </div>
        <div>
          <label>pH <span id="phVal">7.0</span></label>
          <input id="pH" type="range" min="1" max="14" step="0.5" value="7">
        </div>
        <div>
          <label>Stirring <span id="stirVal">500 rpm</span></label>
          <input id="stirring" type="range" min="200" max="800" step="50" value="500">
        </div>
        <div>
          <label>Temp <span id="tempVal">25 ¬∞C</span></label>
          <input id="temp" type="range" min="10" max="100" step="5" value="25">
        </div>
        <div>
          <label>Light Intensity <span id="lightVal">35 W</span></label>
          <input id="lightInt" type="range" min="20" max="50" step="5" value="35">
        </div>
      </div>

      <label>Light Source</label>
      <select id="lightSource">
        <option value="UV">UV Light</option>
        <option value="LED-White" selected>White LED</option>
        <option value="LED-Blue">Blue LED</option>
        <option value="Visible">Visible Light</option>
        <option value="Sunlight">Natural Sunlight</option>
      </select>

      <label>Simulation Depth</label>
      <select id="circuitDepth">
        <option value="2">Level 2 ‚Äì Fast (6 qubits)</option>
        <option value="3">Level 3 ‚Äì Balanced (10 qubits)</option>
        <option value="4" selected>Level 4 ‚Äì Deep (15 qubits)</option>
        <option value="5">Level 5 ‚Äì Maximum (20 qubits)</option>
      </select>

      <button id="optimizeBtn" class="btn">üöÄ Run Quantum Simulation</button>
    </section>

    <section class="panel">
      <h3>‚öõÔ∏è Results & Analysis</h3>
      
      <div id="circuitContainer" class="circuit">
        <div style="text-align:center">
          <div style="font-size:48px">‚öõÔ∏è</div>
          <div>Configure and run simulation</div>
        </div>
      </div>

      <div id="resultBox" class="results-box" style="display:none"></div>

      <h3 style="margin-top:15px">üìä Absorption Spectrum</h3>
      <div id="absContainer" class="circuit" style="display:none;min-height:220px"></div>

      <h3 style="margin-top:15px">üìà Tauc Plot (Optical Bandgap)</h3>
      <div id="taucContainer" class="circuit" style="display:none;min-height:220px"></div>

      <h3 style="margin-top:15px">üìâ Degradation Kinetics</h3>
      <div id="degradContainer" class="circuit" style="display:none;min-height:220px"></div>

      <div id="downloadSection" class="download-section" style="display:none">
        <button class="download-btn" onclick="download('json')">üì• JSON</button>
        <button class="download-btn" onclick="download('circuit')">üñºÔ∏è Circuit</button>
        <button class="download-btn" onclick="download('absorption')">üìä Absorption</button>
        <button class="download-btn" onclick="download('tauc')">üìà Tauc</button>
        <button class="download-btn" onclick="download('kinetics')">üìâ Kinetics</button>
        <button class="download-btn excel" onclick="download('excel')">üìä Excel</button>
        <button class="download-btn" onclick="download('report')">üìÑ Report</button>
      </div>
    </section>
  </main>

  <footer>‚ö° Advanced Quantum Photocatalyst Simulator v4.0 ‚Ä¢ Complete Analysis Suite</footer>

  <script>
    let lastResults = null;
    const ranges = {
      dyeConc: document.getElementById('dyeConc'),
      catConc: document.getElementById('catConc'),
      catSize: document.getElementById('catSize'),
      pH: document.getElementById('pH'),
      stirring: document.getElementById('stirring'),
      temp: document.getElementById('temp'),
      lightInt: document.getElementById('lightInt')
    };

    ranges.dyeConc.oninput = () => document.getElementById('dyeConcVal').textContent = ranges.dyeConc.value + ' ppm';
    ranges.catConc.oninput = () => document.getElementById('catConcVal').textContent = ranges.catConc.value + ' mg';
    ranges.catSize.oninput = () => document.getElementById('catSizeVal').textContent = ranges.catSize.value + ' nm';
    ranges.pH.oninput = () => document.getElementById('phVal').textContent = ranges.pH.value;
    ranges.stirring.oninput = () => document.getElementById('stirVal').textContent = ranges.stirring.value + ' rpm';
    ranges.temp.oninput = () => document.getElementById('tempVal').textContent = ranges.temp.value + ' ¬∞C';
    ranges.lightInt.oninput = () => document.getElementById('lightVal').textContent = ranges.lightInt.value + ' W';

    document.getElementById('materialType').onchange = function() {
      document.getElementById('catCount').textContent = this.selectedOptions.length;
    };
    document.getElementById('dyeType').onchange = function() {
      document.getElementById('dyeCount').textContent = this.selectedOptions.length;
    };
    document.getElementById('circuitDepth').onchange = function() {
      const map = {2: 6, 3: 10, 4: 15, 5: 20};
      document.getElementById('qubitCount').textContent = map[parseInt(this.value)] || 15;
    };

    function selectAll(id) {
      Array.from(document.getElementById(id).options).forEach(o => o.selected = true);
      document.getElementById(id).onchange();
    }
    function clearAll(id) {
      Array.from(document.getElementById(id).options).forEach(o => o.selected = false);
      document.getElementById(id).onchange();
    }

    document.getElementById('optimizeBtn').onclick = async function() {
      const materials = Array.from(document.getElementById('materialType').selectedOptions).map(o => o.value);
      const dyes = Array.from(document.getElementById('dyeType').selectedOptions).map(o => o.value);
      
      if (!materials.length || !dyes.length) {
        alert('‚ö†Ô∏è Select at least one catalyst and one dye!');
        return;
      }

      const concentrations = [parseFloat(ranges.dyeConc.value)];
      const variant = document.getElementById('dyeConcVariant').value;
      if (variant) concentrations.push(parseFloat(variant));

      const params = {
        materials, dyes, dyeConcentrations: concentrations,
        catalystConcentration: parseFloat(ranges.catConc.value),
        catalystSize: parseFloat(ranges.catSize.value),
        pH: parseFloat(ranges.pH.value),
        stirringSpeed: parseFloat(ranges.stirring.value),
        temperature: parseFloat(ranges.temp.value),
        lightSource: document.getElementById('lightSource').value,
        lightIntensity: parseFloat(ranges.lightInt.value),
        circuitDepth: parseInt(document.getElementById('circuitDepth').value)
      };

      const btn = this;
      btn.textContent = '‚öôÔ∏è Simulating...';
      btn.disabled = true;

      try {
        const res = await fetch('/optimize', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(params)
        });
        const data = await res.json();
        
        btn.textContent = 'üöÄ Run Quantum Simulation';
        btn.disabled = false;

        if (!data.success) {
          alert('Error: ' + (data.error || 'unknown'));
          return;
        }

        lastResults = data;

        document.getElementById('circuitContainer').innerHTML = 
          `<img src="data:image/png;base64,${data.circuit_image}">`;
        document.getElementById('absContainer').innerHTML = 
          `<img src="data:image/png;base64,${data.absorption_plot}">`;
        document.getElementById('absContainer').style.display = 'flex';
        document.getElementById('taucContainer').innerHTML = 
          `<img src="data:image/png;base64,${data.tauc_plot}">`;
        document.getElementById('taucContainer').style.display = 'flex';
        document.getElementById('degradContainer').innerHTML = 
          `<img src="data:image/png;base64,${data.degradation_plot}">`;
        document.getElementById('degradContainer').style.display = 'flex';

        const box = document.getElementById('resultBox');
        box.style.display = 'block';
        box.innerHTML = `
          <div style="margin-bottom:10px"><strong>Materials:</strong> ${data.materials.join(', ')}</div>
          <div style="margin-bottom:10px"><strong>Dyes:</strong> ${data.dyes.join(', ')}</div>
          <div style="background:rgba(0,216,255,0.05);padding:10px;border-radius:6px;margin:10px 0;border-left:3px solid #00d8ff">
            <div style="font-weight:bold;margin-bottom:6px">üìä Optical Properties</div>
            <div class="metric-grid">
              <div>Bandgap: <strong>${data.optimized_params.bandgap.toFixed(2)} eV</strong></div>
              <div>Optical Gap: <strong>${data.optical_bandgap.toFixed(2)} eV</strong></div>
              <div>Absorption: <strong>${data.optimized_params.absorption.toFixed(1)}%</strong></div>
              <div>Quantum Yield: <strong>${data.optimized_params.quantum_yield.toFixed(1)}%</strong></div>
            </div>
          </div>
          <div style="background:rgba(255,0,212,0.05);padding:10px;border-radius:6px;border-left:3px solid #ff00d4">
            <div style="font-weight:bold;margin-bottom:6px">üî¨ Degradation Performance</div>
            <div class="metric-grid">
              <div>Degradation: <strong>${data.dye_degradation.toFixed(1)}%</strong></div>
              <div>Time: <strong>${data.reaction_time} min</strong></div>
              <div>Efficiency: <strong>${data.optimized_params.efficiency.toFixed(1)}%</strong></div>
              <div>Yield: <strong>${data.yield_percentage.toFixed(1)}%</strong></div>
            </div>
          </div>
          <p style="margin-top:10px;color:#a7dffb;font-size:12px;font-style:italic">${data.analysis}</p>
        `;

        document.getElementById('downloadSection').style.display = 'grid';

      } catch (err) {
        btn.textContent = 'üöÄ Run Quantum Simulation';
        btn.disabled = false;
        alert('‚ùå Error: ' + err);
      }
    };

    async function download(type) {
      if (!lastResults) { alert('No results'); return; }
      if (type === 'excel') {
        const res = await fetch('/download/excel', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(lastResults)
        });
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `report_${Date.now()}.xlsx`;
        a.click();
      } else if (type === 'json') {
        const blob = new Blob([JSON.stringify(lastResults, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `data_${Date.now()}.json`;
        a.click();
      } else if (['circuit', 'absorption', 'tauc', 'kinetics'].includes(type)) {
        const imgMap = {
          circuit: lastResults.circuit_image,
          absorption: lastResults.absorption_plot,
          tauc: lastResults.tauc_plot,
          kinetics: lastResults.degradation_plot
        };
        const a = document.createElement('a');
        a.href = `data:image/png;base64,${imgMap[type]}`;
        a.download = `${type}_${Date.now()}.png`;
        a.click();
      } else if (type === 'report') {
        const r = lastResults;
        const report = `ADVANCED PHOTOCATALYST ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}

MATERIALS: ${r.materials.join(', ')}
DYES: ${r.dyes.join(', ')}
Concentrations: ${r.dyeConcentrations?.join(', ') || r.dye_concentration} ppm

OPTICAL PROPERTIES
Bandgap: ${r.optimized_params.bandgap.toFixed(2)} eV
Optical Bandgap: ${r.optical_bandgap.toFixed(2)} eV
Absorption: ${r.optimized_params.absorption.toFixed(2)}%

DEGRADATION PERFORMANCE
Degradation: ${r.dye_degradation.toFixed(2)}%
Time: ${r.reaction_time} min
Yield: ${r.yield_percentage.toFixed(2)}%

ANALYSIS
${r.analysis}`;
        const blob = new Blob([report], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `report_${Date.now()}.txt`;
        a.click();
      }
    }
  </script>
</body>
</html>
